{
  log
  debug
  admin off
}

:2016
# d3rgr0em5u5yko.cloudfront.net

handle /api/auth/* {
  reverse_proxy localhost:3000 {
    header_up Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    header_up X-Real-IP {remote}
  }
}

# TODO better matching
# reverse_proxy /v1/* localhost:3002 {
reverse_proxy /v1/* https://d164hjk5s8rpsc.cloudfront.net {
  header_up Host {upstream_hostport}
  header_up Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  header_up X-Real-IP {remote}
}

@notapi {
  not path *api*
}
reverse_proxy @notapi localhost:3000 {
  header_up Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  header_up X-Real-IP {remote}
}
