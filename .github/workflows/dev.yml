# this should call ci with the dev environment inputs
name: CI - dev

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch:
  push:
    branches:
      - 'master'
  pull_request:

jobs:
  run-ci:
    uses: ./.github/workflows/ci.yml
    secrets: inherit
    with:
      environment: dev
      # Use PR head branch name if PR, otherwise use branch name
      appName: ${{  github.head_ref || github.ref_name }}
      # change to github.sha when we add the sha to Sentry.init
      siteSentryRelease: ${{  github.head_ref || github.ref_name }}
      backendSentryRelease: ${{  github.head_ref || github.ref_name }}
      # TODO: It'd be nice to skip building unchanged images
      # if branch is master, set siteTag to latest, otherwise use branch name
      siteTag: ${{  github.ref_name == 'master' && 'latest' || github.head_ref || github.ref_name }}
      backendTag: ${{  github.ref_name == 'master' && 'latest' || github.head_ref || github.ref_name }}
